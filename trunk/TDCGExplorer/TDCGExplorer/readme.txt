TDCGExplorer

基本全自動でなんでもかんでも管理するツールです。
まだβバージョンです。色々実装されていません。

・重要なお知らせ

ここを読まないと困った事になります。

※ TDCGEXPLORER.EXE.CONFIGファイルは消して下さい。
※ 07-11 betaより前のバージョンのarcs.dbは消して再構築して下さい。
※ System.dbをTDCGEXPLORER以外から書き換えるとキャッシュ不整合で
   動作がおかしくなったりarcs.dbが壊れることがあります。
※ カス子の置き場所やZIPの置き場所を変更した時はデータベースの
   初期設定を予め変更してからデータベースの更新をして下さい。
   順番を間違えるとarcs.dbの中身が消えます。
※ 初期設定は開発が進む事でどんどん増えます。動作に差し支えないで
   あろうデフォルト値が自動的に設定されますので、バージョンが
   あがったら初期設定を開いて設定値を確認してください。
   (system.dbはバージョンが上がると自動的に最新版に変換されます)

・変更履歴

07-04 beta2

MOD Referenceサーバ接続機能つきました。簡易ながら検索機能つきました。
DataGridViewによって一部の表示を見やすくしました。

07-05 beta

実行パスに２バイト文字が入っているとTSOを表示しない問題を対策
しました。検索でキーワード入力後、Enterを押すとただちに検索を
実行するようにしました。

パスの取り扱いに不具合があったので大量修正しました。コアモジュールの
ほとんどが書き換えられました。

07-05 beta2

タブページは通常シングルクリックで切り替え表示を行う用にして、
リストボックスはシングルクリックでタブページを表示する様にしました。
ウインドウメニューを追加して右ボタンメニューの内容を収容しました。
各ビューにも右ボタンメニューがありますが機能は同等です。

07-06 beta

TSOビューアの挙動を変えました。通常クリックでは選択されたTSOのみ、
CTRLキーを押しながらクリックすると既にロードしているTSOを消去
しないで追加ロードします。tsoの座標は自動的にセンタリングされて
表示の中心に現れるようになります（カテゴリ文字とtbnが食い違う場合
には画面外に飛び出します）。

07-07 beta

ツリービューをタブにしました。その他UIを多少チューニングしています。
zipファイルを選択すると自動的に3DCG MOD Referenceサーバにアクセス
するように修正しました（前提や関連MODを調べながらMODをインストール
するという作業で参照表示を省力化しました）。前提MODの自動展開機能が
つきました。インストールされていない前提MODをデータベースから参照
して自動的に検索・展開します。

07-07 beta2

ツリー操作中に例外が発生するとResumeLayoutがかかったままになるバグを
修正しました。新規タブ追加のビヘイビアを変更して新規タグが現在開いて
いたタグのコピーではなくブランクタグを追加しました。ちまちまと色々
メモリーリークが発生したのでめぼしい所を潰しました。全ZIPインストールを
敢行して沢山のバグを潰しました。

07-07 beta7

MODREFサーバ参照をON/OFF出来るようにしました。ページがちらつくバグを
抑制してタブがちらつく程度におさえていましたが、それが不評なので
コードを元に戻してタブページが切り替わる都度に全体が点滅するコードに
戻しました。この件に関しては、これを仕様として二度と変更しません。
バグを回避して無理やり抑制するよりこちらのほうがプログラミングモデル的には
理想的でありますので。

07-08 beta

圧縮状態と非圧縮状態の混在管理に対応しました。MODを展開した状態で管理
している場合もZIPディレクトリに指定すると自動認識します。デフォルト設定で
対応しているディレクトリ名フォーマットは、

TA3ch系

	(^TA[0-9]{4})		TA0000で始まる物
	(^TA3CH[0-9]{4})	TA3CH0000で始まる物
	(^TA3DC[0-9]{4})	TA3DC0000で始まる物
	(^TAC[0-9]{4})		TAC0000で始まる物

居酒屋系

	(^TAC[0-9]{5})		TAC00000で始まる物
	(^XPC[0-9]{5})		XPC00000で始まる物

ふたば系

	(^mod[0-9]{4})		mod0000等

大文字小文字は厳密に区別されます。MODのコード名に続けて英数字以外の文字で
何か書いていても構いません。例えば、

XPC00942_【Ｈアイテム】カス子一周年記念MOD 尿道玩具@尿道スティック

この場合先頭のXPC00942でまず一致し、次にMOD正規表現で示されたルールで
XPC00942が取り出されます。ディレクトリのフルネームは、コード部分以降が
何も書いていない場合にはMOD Referenceサーバに問い合わせ、書いてある
場合にはその名称が表示されます。このフォーマットに準拠してない場合には、
ZIP正規表現とMOD正規表現をそろえて修正してください。

標準対応のアップローダ以外や個人配布のMODを追加したい場合には、以下の例の
様に追加してください。条件と条件の間は|記号でつなげて下さい。

例
	(^[nN][0-9]{3}[^0-9])

正規表現フォーマットはPOSIX仕様になっています。

07-09 beta

3DCG MOD Referenceサーバのタグ情報を取り込む機能を搭載しました。
MODをタグ別に分類して管理する事ができます。なおタグやMOD名は１日１回、
朝７時ごろにサーバ上のリレーショナルデータベースからTDCGExplorer用の
ファイル形式に変換して準備するので、データベースの最新情報の取得は
よく朝７時以降に反映されます。

07-09 beta2

ローカルキャッシュファイルが壊れるバグを修正しました。

07-09 beta3

ユーザーインターフェースを変更しました。初期設定でZIP選択時の動作が
変更できます。起動時に毎回必ずarcnames.zip/tagnames.zipを取得する様に
設定できるようにしました(デフォルトはオフです)。画像の拡大縮小が出来る
ようになりました。初期表示時は全体表示、クリックで拡大表示になります。

3DCG Mods Reference Serverのタグ情報更新間隔を１日１回から１時間に
１回更新するようにしました。TDCGExplorer上からタグ情報を変更すると
１時間後には更新されたタグ情報を受け取る事ができます。

07-10 beta

セーブファイルビューアを統合しました。一応tahバージョンを見て、もっとも
上のtsoを選択するようにしてありますがそれでも色々とアレな結果になります。
というのはTDCGExplorerのセーブファイルビューアはarcs全部とzip全部を
調べ上げて該当するtsoを探してきます。arcsにあるパーツが優先して使われ
ますので、インストール済みのパーツは比較的良好な結果になりますが、
zipを探しにいくと重複があった場合にパーツを間違えてしまいます。

07-10 beta6

パーツ探索をtsoファイル名からハッシュキー検索に置き換えました(tso名検索は
曖昧検索なので遅いので)。tso検索中もイベントを処理して操作待ち時間を削減
しました。

07-11 beta

コアコンポーネントの変更です。TDCG.DLLが更新されました(nomeuさん有難う
ございます）。TAHFile.csを変更して、TAHdecryptorが間違ったtahファイルを
作ってしまい、解凍できない問題に対応しました（間違っているtahファイルは
arcs.dbに登録されないので、arcs.dbファイルを削除して再構築する必要が
あります）。TAHファイルの解凍機能がつきました。ZIPファイルを解凍する
ことなく、直接TAHファイルの中身を展開します。展開先はZIPファイル展開先
ディレクトリと同じです。

TAH梱包機能については、単体実装ではなくTAHエディタ機能の一つとして実装
する予定です。

動作速度を向上させる為に、データベースのデフラグメンテーションを必ず
実行する様にしました。この為、arcs.dbが置かれるハードディスクの空き
容量は200MB以上必要になります。

07-11 beta2,3

ツリービューの表示が不適切になる不具合を修正。結構致命的。
.NETのTreeView使えなさすぎ。

07-12 beta4

TDCGExplorerコアコンポーネントをリファクタリング。検索結果がタブ移動で
色が移動してしまうバグを修正。ラベルノードを選択した状態で空のツリーを
選択するとNULLポインタ例外で落ちるバグを修正。

07-12 beta5

一部のパーツが読めない・表示されないTSOが表示されるようになりました。
(nomeuさんありがとうございます)。UIを一部変更しました。tahバージョン
比較が3Dカスタム少女と違う場合があったので修正しました。

07-12 beta6

tmoのアニメーション速度を同期してもらいました(nomeuさんありがとう)。

07-12 beta7

ヘビーセーブデータに対応しました。ヘビーセーブでも通常セーブと同様に、
該当パーツの探索をデータベースから行いますが、表示するtsoはヘビー
セーブ中のデータを使用します（データベースから検索できたtsoデータは
使いません）。

07-12 beta8

セーブデータ読み出しに不具合があったのでバイナリリーダにしました。

07-12 beta9

逆行ハイライトボディが表示されない件が解決しました(nomeuさん有難う
ございます)。toonshader.cgfxを20090622版に更新しました。TSO表示中に
TSOビューワをリセットするとnullポインタ参照が発生する件を修正しました。

07-13 beta

TSOロード時にカメラをリセットして顔を写す様にしました。この設定は
初期設定で解除する事ができます。時勢を配慮した初期設定という事で
ご理解下さい。

07-13 beta2

回転中心が首に移動していたバグを修正しました。また回転中心や、初期
視点を初期設定で変更可能にしました。default.tmoを変更しなくても
セーブデータの初期表示位置を初期設定で変更できます（ボーン名で指定
して下さい。存在しないボーンを指定するとつま先になります。ボーンが
よく分からない時はデフォルト設定で使ってください）。

初期位置を設定できる様になったのでカメラ視点のリセットのデフォルト
値はオフにしました。

07-15 beta

TAHWriterコンポーネントを搭載しました。TAHファイルの一部だけの取り出し、
一部または全部の梱包、リネームが行えます。TAHdecGUIの機能にはまだ
及びませんが、TAHファイルの編集ができるようになりした。

07-16 beta

TAHの属性変更が出来るようになりました。TAH編集でエラーがあった場合には
トランザクションをロールバックして編集を取り消すようにしました。
衝突チェックでハッシュ衝突に加えて内部ファイル名衝突も表示出来るように
しました。

・注意事項

.NET Framework 3.5SP1以降、DirectX9 Mar-2009以降が必要です。
.NET Framework 3.5以前・DirectX9 Jan-2009以前では動作しません。

まずオリジナルファイルを勝手に書き換える事は無いと思いますが
万が一の事を考えて、必ずバックアップをとっておいてください。

Windows Vista Business "英語版" x86バージョンで動作確認しています。
それ以外のOSでは現時点では未検証なのでご注意ください。

Pixel Shader 2.0以上を搭載したGPUのビデオカードが必要です。
ハードディスクの空き容量は少なくともMy Documentsもしくは
Documentsフォルダのあるディスクに200MB以上必要です。

メモリはかなり使います。少なくとも物理メモリが1GBないと
動作がかなり遅くなります。2GB以上搭載を推奨します。

CPUはintel Core2以上を推奨します。マルチスレッドですが、
並列度は高くないので2GHz以上の2コアCPUで十分です（Core2Quad
Q6600でデータベースのチューニングを行っています）。

3Dカスタム少女XPがインストールされていない場合の動作は未検証です。
インストールされている事が大前提なので必ず3Dカスタム少女XPが
インストールされているPCで実行してください（体験版不可）。

機能要望バグ報告は2ch IRC #3Dカスタム少女か、職人ギルドに
お願いいたします。

・簡単な使い方

初めての起動

(1) 統合アーカイバプロジェクトからUNLHA32.DLLを入手して
　　システムにインストールする。
　　http://www.madobe.net/archiver/index.html

(2) プログラムを起動してデータベースメニューで初期設定を実行。

(3) 各種パス名（arcsやzipファイル置き場など）を設定。
　　それ以外の要素は判らないならデフォルトのままで
　　使ってください。

(4) データベースの構築・更新を実行。かなり時間がかかります。
　　しばらくPCを放置しておいてください。

２回目からの起動

(1) arcsやZIP置き場の中身を変更している場合はデータベースの
　　構築・更新を実行してください（データベース上にあるデータを
　　操作するだけなら実行しなくても問題はありませんが、アクセス
　　出来なくなったtahやzipへの操作がエラーになります）。

・画面の説明

基本的な操作はAppleのiTunesと同等です。画面右側のツリーを
操作すると、ツリー右隣のファイルツリーが更新されて、そこを
ダブルクリックするとそのファイルに対するアクションが用意
されていると、ファイル一覧下のタブにアクション結果が表示
されます。

現在実装されているアクションは

zipファイル：zip一覧の表示、zipの展開、アノテーション入力。
tahファイル：tah一覧の表示。リネームは未実装。
tsoファイル：TSOビューワでの表示（TAHファイル中のTSOのみ）
tmoファイル：TSOビューワでの表示（TAHファイル中のTSOのみ）
セーブファイル：3D表示、関連tahファイルの検索

・ファイルはどこにできるの？

XPの場合、マイドキュメントのTechArts3D\TDCG\TDCGExplorerに、
Vistaの場合、ドキュメントのTechArts3D\TDCG\TDCGExplorerに
各種データベースやキャッシュファイルを配置します。ZIP置き場の
デフォルトもこのディレクトリの下になっていますが、初期設定を
変更する事で他のディレクトリに変更できます。

・わかっている不具合

1.ファイアーウオールを超えられません。ファイアウオールが
　ある場合には透過型アプリケーションプロキシを用意して下さい。
　ローカルキャッシュファイルは別な方法で取得して配置する事で、
　取り込む事は可能です。

2.展開したり表示できないtsoファイルがある。
　tahファイルについては原因をnomeuさんが解明したので、
　対応しました（感謝）。

3.zipを展開すると色が変わりますが、これは現在起動時のみで
  次回起動すると元の色に戻ります。この情報は恒久的に保存する
  予定はありません。

4.ディレクトリ名に.zipとか.lzhとか.rarで終わる場合に誤動作する。
　対応可能なのですがテーブル仕様が変更になる事と、コアの
　大幅変更が必要になり、レアケースに為にバグが出るかもしれない
　大改造をする必要があるだろうか？とも思っています。

5.デフォルトのMOD認識正規表現は実は正しく3ch系と居酒屋系を分離
　できていません。システム的にはMODであると認識できればそれで
　十分で、特定のアップローダを識別する必要は無いのでこれは仕様
　という事に。

6.同じ作者の尿道スティックが画面外に飛び出すとはどういう事だ
　とかいう話があります。これはTSO名が本来手持ちを考慮していた
　ところを尿道に突っ込んだりしたからそういう事になります。
　手持ち系で眉等に割り当てられている物も同様の結果になります。

7.プラグイン開発の仕様がまだ固まっていません。任意のファイル
　要素を任意に取り出して処理する為のインターフェースを整理
　する必要がありますが、開発途上の現時点ではそれを実行するに
　至っていません。

・今後の予定

3DCG MOD Referrenceサーバとの連携を強化します。関連情報や
前提MOD情報の調査や、タグ分類機能等を搭載します。TAHファイルの
リネームはTBNエディタモジュールが出来たら搭載します。原則、
あらゆる全ては全自動のポリシーに基づき、「ぽちっとな」操作で
なんでも出来るツールを目指します(TAHdecGUIやtso2mqo,mqo2tsoの
機能は統合したいと思っています)。

TAHエディタ構想を考えています。いったんTAHの構成要素を取り込んで
自由に編集して保存できるような物を考えています。構成要素情報も
データベース上に取り込んで、一度TAH化した作業は次から自動的に
再利用できるようにしたいと思います。tso2mqo,mqo2tsoもTAHエディタの
１コンポーネントとして取り込む予定です。TAHエディタが完成すれば
TDCGExplorerはβからRCになります。

3DCG MOD Referrenceサーバの運用支援機能が優先して搭載されると
思いますので、リクエストがありましたら、2ch IRC #3Dカスタム少女
までおこしください。

・リクルート

取り扱い説明書を書いてくれる方募集中です。誰でも読めるドキュメントと
いうとPDFファイルかHTMLファイルになると思うのですが、機能てんこもり
な上に頻繁に仕様変更や機能追加があるので、現時点では図表を満載した
マニュアル化をしようという余裕がありません。

・謝辞

・メインとなる情報のリストアップはTAHDUMPを使用しました。
・圧縮ファイル展開はTDCGManを使用しました。
・TSOViewアセンブリを使用しています。
・バックエンドデータベースはSQLite3を使用しました。
・その他数々のツールを流用しました。

作者の皆様、ありがとうございます。

Konoa/N765
